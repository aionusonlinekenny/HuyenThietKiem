# Simple Map Tool - HÆ°á»›ng Dáº«n ÄÆ¡n Giáº£n

## ğŸ¯ Tool Má»›i Sáº½ ÄÆ¡n Giáº£n NhÆ° Tháº¿ NÃ o?

### âŒ Tool CÅ© (Phá»©c táº¡p):
```
1. User pháº£i biáº¿t map folder path
2. User pháº£i manually load .wor file
3. User pháº£i nháº­p RegionX, RegionY manually
4. User pháº£i click "Load Region" cho tá»«ng region
5. Dá»… nháº§m láº«n, nhiá»u bÆ°á»›c
```

### âœ… Tool Má»›i (ÄÆ¡n giáº£n):
```
1. Chá»n game folder: D:\HuyenThietKiem\Bin\Server
2. Nháº­p Map ID: 11
3. Click "Load Map"
4. XONG! Tool tá»± Ä‘á»™ng load Táº¤T Cáº¢
```

---

## ğŸš€ UI Tool Má»›i

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Simple Map Coordinate Tool                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚ ğŸ“ Game Folder:                                      â”‚
â”‚    [D:\HuyenThietKiem\Bin\Server___________] [ğŸ“]    â”‚
â”‚    â—‹ Server    â—‹ Client                              â”‚
â”‚                                                       â”‚
â”‚ ğŸ—ºï¸ Map ID:                                           â”‚
â”‚    [11__] [Load Map]                                 â”‚
â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸ Map Info:                                          â”‚
â”‚    Name: ThÃ nh ÄÃ´ (æˆéƒ½)                             â”‚
â”‚    Folder: åœºæ™¯åœ°å›¾\åŸå¸‚\æˆéƒ½                        â”‚
â”‚    Region Grid: 4x4 (16 regions total)               â”‚
â”‚    Map Size: 2048 x 4096 pixels                      â”‚
â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ–¼ï¸ Map Viewer                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
â”‚ â”‚â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚ â”‚
â”‚ â”‚â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚ â”‚
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ğŸŸ¢â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚ â† ğŸŸ¢ = Selected cell
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚ â† â–‘ = Walkable
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚ â† â–ˆ = Obstacle
â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [Zoom In] [Zoom Out] [Reset View]                    â”‚
â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Selected Coordinates:                              â”‚
â”‚    World:    (5000, 10000)                           â”‚
â”‚    Region:   (9, 9)      [RegionID: 589833]          â”‚
â”‚    Cell:     (12, 24)                                â”‚
â”‚    Offset:   (8, 16)                                 â”‚
â”‚                                                       â”‚
â”‚ ğŸ“ Trap Entry:                                        â”‚
â”‚    11	589833	12	24	\script\maps\trap\11\1.lua	1 â”‚
â”‚                                                       â”‚
â”‚ [Copy Coordinates] [Add to List] [Export to File]    â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Workflow Tá»± Äá»™ng

### BÆ°á»›c 1: User Input
```
Game Folder: D:\HuyenThietKiem\Bin\Server
Map ID: 11
```

### BÆ°á»›c 2: Tool Tá»± Äá»™ng LÃ m

#### 2.1. Äá»c MapList.ini
```csharp
string mapListPath = Path.Combine(gameFolder, "Settings", "MapList.ini");
string mapFolder = ReadIniValue(mapListPath, "List", "11");
// Result: mapFolder = "åœºæ™¯åœ°å›¾\åŸå¸‚\æˆéƒ½"

string mapName = ReadIniValue(mapListPath, "List", "11_name");
// Result: mapName = "ThÃ nh ÄÃ´"
```

#### 2.2. Load .wor File
```csharp
string worPath = Path.Combine(gameFolder, "maps", mapFolder, "æˆéƒ½.wor");
RECT rect = ReadIniRect(worPath, "MAIN", "rect");
// Result: rect = {left=0, top=0, right=3, bottom=3}

int regionWidth = rect.right - rect.left + 1;   // 4
int regionHeight = rect.bottom - rect.top + 1;  // 4
int totalRegions = regionWidth * regionHeight;  // 16
```

#### 2.3. Auto Load Táº¤T Cáº¢ Regions
```csharp
for (int y = rect.top; y <= rect.bottom; y++)
{
    for (int x = rect.left; x <= rect.right; x++)
    {
        string regionPath = Path.Combine(
            gameFolder, "maps", mapFolder,
            $"v_{y:D3}",
            $"{x:D3}_Region_S.dat"  // hoáº·c _Region_C.dat náº¿u lÃ  client
        );

        if (File.Exists(regionPath))
        {
            LoadRegionData(regionPath, x, y);
            progressBar.Value = (y * regionWidth + x + 1) * 100 / totalRegions;
        }
    }
}
```

#### 2.4. Parse Region Files
```csharp
void LoadRegionData(string path, int regionX, int regionY)
{
    using (BinaryReader reader = new BinaryReader(File.OpenRead(path)))
    {
        // Read combined file header
        uint numSections = reader.ReadUInt32();
        var sections = new Section[numSections];

        for (int i = 0; i < numSections; i++)
        {
            sections[i].offset = reader.ReadUInt32();
            sections[i].length = reader.ReadUInt32();
        }

        int headerSize = 4 + numSections * 8;

        // Load Obstacle grid (16x32 cells)
        reader.BaseStream.Seek(headerSize + sections[0].offset, SeekOrigin.Begin);
        byte[,] obstacles = new byte[16, 32];
        for (int cy = 0; cy < 32; cy++)
            for (int cx = 0; cx < 16; cx++)
                obstacles[cx, cy] = reader.ReadByte();

        // Load Trap grid (16x32 cells) if exists
        if (numSections > 1 && sections[1].length > 0)
        {
            reader.BaseStream.Seek(headerSize + sections[1].offset, SeekOrigin.Begin);
            byte[,] traps = new byte[16, 32];
            for (int cy = 0; cy < 32; cy++)
                for (int cx = 0; cx < 16; cx++)
                    traps[cx, cy] = reader.ReadByte();
        }

        // Store in map data
        mapData[regionX, regionY] = new RegionData
        {
            RegionX = regionX,
            RegionY = regionY,
            Obstacles = obstacles,
            Traps = traps
        };
    }
}
```

#### 2.5. Render Map
```csharp
void RenderMap(Graphics g)
{
    for (int ry = 0; ry < regionHeight; ry++)
    {
        for (int rx = 0; rx < regionWidth; rx++)
        {
            var region = mapData[rx, ry];
            if (region == null) continue;

            for (int cy = 0; cy < 32; cy++)
            {
                for (int cx = 0; cx < 16; cx++)
                {
                    int screenX = (rx * 16 + cx) * cellSize;
                    int screenY = (ry * 32 + cy) * cellSize;

                    // Draw cell
                    Color color = Color.LightGreen;  // Walkable
                    if (region.Obstacles[cx, cy] != 0)
                        color = Color.Red;  // Obstacle
                    else if (region.Traps != null && region.Traps[cx, cy] != 0)
                        color = Color.Yellow;  // Trap

                    g.FillRectangle(new SolidBrush(color),
                        screenX, screenY, cellSize, cellSize);

                    // Draw grid
                    g.DrawRectangle(Pens.Gray,
                        screenX, screenY, cellSize, cellSize);
                }
            }
        }
    }
}
```

#### 2.6. Handle Click
```csharp
void MapPanel_Click(object sender, MouseEventArgs e)
{
    // Screen to World conversion
    int worldX = (e.X / cellSize) * 32;
    int worldY = (e.Y / cellSize) * 32;

    // World to Region/Cell
    int regionX = worldX / 512;
    int regionY = worldY / 1024;
    int cellX = (worldX % 512) / 32;
    int cellY = (worldY % 1024) / 32;
    int regionID = regionX | (regionY << 16);

    // Display
    txtWorldX.Text = worldX.ToString();
    txtWorldY.Text = worldY.ToString();
    txtRegionX.Text = regionX.ToString();
    txtRegionY.Text = regionY.ToString();
    txtRegionID.Text = regionID.ToString();
    txtCellX.Text = cellX.ToString();
    txtCellY.Text = cellY.ToString();

    // Generate trap entry
    string trapEntry = $"{mapId}\t{regionID}\t{cellX}\t{cellY}\t\\script\\maps\\trap\\{mapId}\\1.lua\t1";
    txtTrapEntry.Text = trapEntry;
}
```

---

## ğŸ“Š So SÃ¡nh Tool CÅ© vs Tool Má»›i

| Feature | Tool CÅ© | Tool Má»›i |
|---------|---------|----------|
| **BÆ°á»›c Ä‘á»ƒ load map** | 5-10 bÆ°á»›c | 3 bÆ°á»›c |
| **User pháº£i biáº¿t** | File paths, region coords | Chá»‰ game folder + map ID |
| **Load regions** | Manual tá»«ng region | Auto load táº¥t cáº£ |
| **MapList.ini** | KhÃ´ng dÃ¹ng | Tá»± Ä‘á»™ng Ä‘á»c |
| **Error handling** | Dá»… sai path | Auto validate |
| **Render speed** | Manual refresh | Auto render |
| **Export** | Manual copy/paste | One-click export |

---

## ğŸ® Example Usage

### Scenario 1: Táº¡o Trap cho Map 11 (ThÃ nh ÄÃ´)

**Old Tool:**
```
1. Má»Ÿ tool
2. Click "Browse .wor" â†’ tÃ¬m file Bin\Server\maps\åœºæ™¯åœ°å›¾\åŸå¸‚\æˆéƒ½\æˆéƒ½.wor
3. Click "Load"
4. Nháº­p RegionX: 0, RegionY: 0
5. Click "Load Region"
6. Chá» load...
7. Click trÃªn map
8. Copy coordinates
9. Láº·p láº¡i cho tá»«ng region khÃ¡c
```

**New Tool:**
```
1. Má»Ÿ tool
2. Browse game folder: D:\HuyenThietKiem\Bin\Server
3. Nháº­p Map ID: 11
4. Click "Load Map"
5. XONG! Click anywhere â†’ get coordinates
```

### Scenario 2: Export Trap List

**Old Tool:**
```
1. Click cell â†’ manual copy
2. Paste vÃ o notepad
3. Format láº¡i
4. Láº·p láº¡i cho tá»«ng cell
5. Save file
```

**New Tool:**
```
1. Click cells muá»‘n add trap
2. Má»—i click â†’ auto add to list
3. Click "Export to File"
4. Chá»n save location
5. XONG! File ready to use
```

---

## ğŸ”§ Implementation Checklist

### Phase 1: Basic Auto-Load âœ…
- [x] Browse game folder
- [x] Read MapList.ini
- [x] Load .wor file
- [x] Auto-detect all regions
- [x] Load all region files
- [x] Display map info

### Phase 2: Visual Rendering ğŸŸ¡
- [ ] Render region grid
- [ ] Render cell grid
- [ ] Color code obstacles (red)
- [ ] Color code traps (yellow)
- [ ] Highlight selected cell (green)
- [ ] Zoom in/out
- [ ] Pan view

### Phase 3: Coordinate System ğŸŸ¡
- [ ] Screen to World conversion
- [ ] World to Region/Cell conversion
- [ ] Click to select cell
- [ ] Display all coordinates
- [ ] Auto-generate trap entry

### Phase 4: Export Features â³
- [ ] Add to trap list
- [ ] Edit trap entries
- [ ] Remove from list
- [ ] Export to file
- [ ] Import from file
- [ ] Batch operations

### Phase 5: Advanced Features â³
- [ ] Show NPC positions
- [ ] Show Object positions
- [ ] Filter by type
- [ ] Search functionality
- [ ] Multiple map support
- [ ] Compare client/server data

---

## ğŸ“ Next Steps

### Option 1: Táº¡o Tool Má»›i Tá»« Äáº§u
- Táº¡o C# Windows Forms app má»›i
- Implement theo design trÃªn
- ÄÆ¡n giáº£n, clean code
- Focus vÃ o auto-load workflow

### Option 2: Cáº£i Tiáº¿n Tool CÅ©
- ThÃªm chá»©c nÄƒng "Auto Load from Game Folder"
- Keep existing features
- Add new simplified workflow
- Backward compatible

### Option 3: Táº¡o Python Tool ÄÆ¡n Giáº£n
- Command-line interface
- Fast prototyping
- Easy to modify
- Good for scripting

---

## ğŸ’¡ Recommendation

**TÃ´i Ä‘á» xuáº¥t: Táº¡o tool Má»šI Ä‘Æ¡n giáº£n (Option 1)**

**LÃ½ do:**
- âœ… Workflow rÃµ rÃ ng, dá»… hiá»ƒu
- âœ… Code sáº¡ch, dá»… maintain
- âœ… UI/UX tá»‘t hÆ¡n
- âœ… Auto-load nhÆ° game
- âœ… Ãt bug hÆ¡n

**Timeline:**
- Phase 1 (Auto-Load): ~2 hours
- Phase 2 (Rendering): ~3 hours
- Phase 3 (Coordinates): ~1 hour
- Phase 4 (Export): ~1 hour
- **Total: ~7 hours coding**

---

## ğŸ¯ Káº¿t Luáº­n

Tool má»›i sáº½:
1. **ÄÆ¡n giáº£n hÆ¡n** - Chá»‰ cáº§n game folder + map ID
2. **Tá»± Ä‘á»™ng hÆ¡n** - Load táº¥t cáº£ regions tá»± Ä‘á»™ng
3. **Nhanh hÆ¡n** - KhÃ´ng cáº§n manual tá»«ng bÆ°á»›c
4. **Ãt lá»—i hÆ¡n** - Auto validate paths
5. **Dá»… dÃ¹ng hÆ¡n** - Workflow giá»‘ng game

**User chá»‰ cáº§n:**
- Browse to game folder
- Nháº­p Map ID
- Click Load
- Done! ğŸ‰
